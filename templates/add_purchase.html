<h2>üì• –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É</h2>
<form method="post">
  <input type="hidden" name="mode" id="mode" value="filter">

  <label>–î–∞—Ç–∞:</label><br>
  <input type="date" name="date" required><br><br>

  <label>–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:</label><br>
  <select name="contractor" onchange="document.getElementById('mode').value='filter'; this.form.submit();">
    <option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å ‚Äî</option>
    {% for c in contractors %}
      <option value="{{ c }}" {% if c == selected_contractor %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select><br>
  <label>–∏–ª–∏ –Ω–æ–≤—ã–π:</label><br>
  <input name="new_contractor" type="text"><br><br>

  <label>–ò—Å—Ç–æ—á–Ω–∏–∫ –æ–ø–ª–∞—Ç—ã:</label><br>
  <input list="payment_sources" name="payment_source">
  <datalist id="payment_sources">
    {% for v in payment_sources %}<option value="{{ v }}">{% endfor %}
  </datalist><br><br>

  <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤:</label><br>
  <input list="expense_categories" name="expense_category">
  <datalist id="expense_categories">
    {% for v in expense_categories %}<option value="{{ v }}">{% endfor %}
  </datalist><br><br>

  <label>–í–∏–¥ —Ä–∞—Å—Ö–æ–¥–æ–≤:</label><br>
  <input list="expense_types" name="expense_type">
  <datalist id="expense_types">
    {% for v in expense_types %}<option value="{{ v }}">{% endfor %}
  </datalist><br><br>

  <table border="1" cellpadding="5" id="items-table">
    <tr>
      <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th><th>–ù–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</th><th>–ï–¥.</th><th>–ö–æ–ª-–≤–æ —É–ø–∞–∫–æ–≤–æ–∫</th>
      <th>–ö–æ–ª-–≤–æ –≤ —É–ø–∞–∫–æ–≤–∫–µ</th><th>–¶–µ–Ω–∞ (–∑–∞ —É–ø–∞–∫.)</th><th>–°—Ç–æ–∏–º–æ—Å—Ç—å (–æ–±—â–∞—è)</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
    </tr>
    <tr>
      <td>
        <select name="material_0">
          {% for m in materials %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
        </select>
      </td>
      <td><input type="text" name="new_material_0"></td>
      <td><input type="text" name="unit_0" value="—à—Ç"></td>
      <td><input type="number" step="0.01" name="qty_packs_0"></td>
      <td><input type="number" step="0.01" name="units_per_pack_0"></td>
      <td><input type="number" step="0.01" name="price_per_pack_0"></td>
      <td><input type="number" step="0.01" name="total_cost_0"></td>
      <td><input type="text" name="comment_0"></td>
    </tr>
  </table>
  <button type="button" onclick="addRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button><br><br>

  <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (–Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã):</label><br>
  <input name="delivery" type="number" step="0.01"><br><br>

  <button type="submit" onclick="document.getElementById('mode').value='save';">üíæ –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É</button>
</form>
<br><a href='/dashboard'>‚¨Ö –ù–∞–∑–∞–¥</a>

<script>
let rowIndex = 1;
function addRow() {
  const table = document.getElementById("items-table");
  const row = table.insertRow();
  row.innerHTML = `
    <td>
      <select name="material_${rowIndex}">
        {% for m in materials %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
      </select>
    </td>
    <td><input type="text" name="new_material_${rowIndex}"></td>
    <td><input type="text" name="unit_${rowIndex}" value="—à—Ç"></td>
    <td><input type="number" step="0.01" name="qty_packs_${rowIndex}"></td>
    <td><input type="number" step="0.01" name="units_per_pack_${rowIndex}"></td>
    <td><input type="number" step="0.01" name="price_per_pack_${rowIndex}"></td>
    <td><input type="number" step="0.01" name="total_cost_${rowIndex}"></td>
    <td><input type="text" name="comment_${rowIndex}"></td>
  `;
  rowIndex++;
}
</script>
