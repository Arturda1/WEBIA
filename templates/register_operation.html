<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏</title>
    <script>
        const structure = {{ structure | tojson }};
        function updateSubcategories() {
            const category = document.getElementById("category").value;
            const subcategorySelect = document.getElementById("subcategory");
            const operationSelect = document.getElementById("operation");

            subcategorySelect.innerHTML = "";
            operationSelect.innerHTML = "";

            if (structure[category]) {
                for (const subcat of Object.keys(structure[category])) {
                    const option = document.createElement("option");
                    option.value = subcat;
                    option.textContent = subcat;
                    subcategorySelect.appendChild(option);
                }
                updateOperations();
            }
        }

        function updateOperations() {
            const category = document.getElementById("category").value;
            const subcategory = document.getElementById("subcategory").value;
            const operationSelect = document.getElementById("operation");

            operationSelect.innerHTML = "";

            if (structure[category] && structure[category][subcategory]) {
                for (const op of structure[category][subcategory]) {
                    const option = document.createElement("option");
                    option.value = op;
                    option.textContent = op;
                    operationSelect.appendChild(option);
                }
            }
        }

        window.onload = function () {
            updateSubcategories();
        };
    </script>
</head>
<body>
    <h2>üìã –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
    <form method="POST">
        <p><strong>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</strong> {{ session["user"] }}</p>

        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label><br>
        <select id="category" name="category" onchange="updateSubcategories()" required>
            {% for cat in structure %}
                <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
        </select><br><br>

        <label for="subcategory">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label><br>
        <select id="subcategory" name="subcategory" onchange="updateOperations()" required></select><br><br>

        <label for="operation">–û–ø–µ—Ä–∞—Ü–∏—è:</label><br>
        <select id="operation" name="stage" required></select><br><br>

        <label for="amount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label><br>
        <input type="number" name="amount" id="amount" min="0" step="1" required><br><br>

        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    </form>
    <br>
    <a href="/dashboard">üîô –ù–∞–∑–∞–¥</a>
</body>
</html>
