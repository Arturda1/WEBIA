{% extends "base.html" %}
{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏{% endblock %}
{% block content %}
<h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
<form method="post">
  <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
  <select id="category" name="category" required>
    {% for cat in categories %}
    <option value="{{ cat }}">{{ cat }}</option>
    {% endfor %}
  </select>

  <label for="subcategory">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
  <select id="subcategory" name="subcategory" required></select>

  <label for="operation">–û–ø–µ—Ä–∞—Ü–∏—è:</label>
  <select id="operation" name="operation" required></select>

  <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
  <input type="number" name="count" value="1" min="1">

  <button type="submit">‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
</form>
<a href="/dashboard">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
<script>
const subcats = {{ subcategories_json | safe }};
const ops = {{ operations_json | safe }};
const subSel = document.getElementById("subcategory");
const opSel = document.getElementById("operation");
document.getElementById("category").onchange = function () {
  const cat = this.value;
  subSel.innerHTML = "";
  opsel.innerHTML = "";
  for (const sub of subcats[cat] || []) {
    const o = document.createElement("option");
    o.value = o.text = sub;
    subSel.appendChild(o);
  }
  subSel.dispatchEvent(new Event("change"));
};
subSel.onchange = function () {
  const key = document.getElementById("category").value + ":" + this.value;
  opSel.innerHTML = "";
  for (const op of ops[key] || []) {
    const o = document.createElement("option");
    o.value = o.text = op;
    opSel.appendChild(o);
  }
};
document.getElementById("category").dispatchEvent(new Event("change"));
</script>
{% endblock %}